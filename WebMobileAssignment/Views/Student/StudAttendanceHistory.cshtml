@{
    ViewBag.Title = "Student Attendance History";
    ViewBag.ActiveMenu = "Attendance";
    ViewBag.ActiveSubmenu = "StudAttendanceHistory";
    Layout = "~/Views/Shared/_StudentLayout.cshtml";
}

<div class="dashboard-card mb-4">

    <!-- Header -->
    <div class="card-header-custom d-flex align-items-center justify-content-between">
        <h3 class="card-title">
            <i class="bi bi-clock-history"></i>
            Attendance History
        </h3>

        <div class="d-flex gap-2 align-items-center">
            <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input id="tableSearch" type="text" class="form-control"
                       placeholder="Search (class, subject)" />
            </div>

            <button id="exportExcelBtn" class="btn btn-sm btn-success">
                <i class="bi bi-file-earmark-excel"></i> Excel
            </button>

            <button id="exportPdfBtn" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-file-earmark-pdf"></i> PDF
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <label class="form-label">Class</label>
            <select id="filterClass" class="form-select">
                <option value="">All Classes</option>
                <option>Form 5 Science</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Month</label>
            <input id="filterMonth" type="month" class="form-control" value="2024-01" />
        </div>

        <div class="col-md-3">
            <label class="form-label">Status</label>
            <select id="filterStatus" class="form-select">
                <option value="">All Status</option>
                <option>Present</option>
                <option>Late</option>
                <option>Absent</option>
            </select>
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-primary w-100">
                <i class="bi bi-search"></i> Search
            </button>
        </div>
    </div>

    <!-- Attendance Table -->
    <div class="table-responsive">
        <table id="attendanceTable" class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Date</th>
                    <th>Day</th>
                    <th>Class</th>
                    <th>Subject</th>
                    <th>Time In</th>
                    <th>Time Out</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>

                <tr>
                    <td><strong>2024-01-15</strong></td>
                    <td>Monday</td>
                    <td>Form 5 Science</td>
                    <td>Mathematics</td>
                    <td>2:00 PM</td>
                    <td>4:00 PM</td>
                    <td><span class="badge bg-success">Present</span></td>
                </tr>

                <tr>
                    <td><strong>2024-01-14</strong></td>
                    <td>Sunday</td>
                    <td>Form 5 Science</td>
                    <td>Science</td>
                    <td>2:15 PM</td>
                    <td>4:15 PM</td>
                    <td><span class="badge bg-warning">Late</span></td>
                </tr>

                <tr>
                    <td><strong>2024-01-13</strong></td>
                    <td>Saturday</td>
                    <td>Form 5 Science</td>
                    <td>English</td>
                    <td>-</td>
                    <td>-</td>
                    <td><span class="badge bg-danger">Absent</span></td>
                </tr>

            </tbody>
        </table>
    </div>
</div>

@section Scripts {

    <!-- Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <!-- PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <script>
        // -------- EXCEL EXPORT --------
        document.getElementById("exportExcelBtn").addEventListener("click", function () {
            const table = document.getElementById("attendanceTable");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Attendance" });
            XLSX.writeFile(wb, "attendance-history.xlsx");
        });

        // -------- PDF EXPORT (DOCUMENT STYLE) --------
        document.getElementById("exportPdfBtn").addEventListener("click", function () {

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF("p", "pt", "a4");

            doc.setFontSize(14);
            doc.text("Student Attendance History Report", 40, 40);

            doc.setFontSize(10);
            doc.text("Generated on: " + new Date().toLocaleString(), 40, 60);

            doc.autoTable({
                startY: 80,
                html: "#attendanceTable",
                styles: { fontSize: 9 },
                headStyles: { fillColor: [245, 245, 245] },
                margin: { left: 40, right: 40 }
            });

            doc.save("attendance-history.pdf");
        });
    </script>
}
