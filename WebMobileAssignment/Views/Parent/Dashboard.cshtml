@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_ParentLayout.cshtml";
}

<div class="row g-3 mb-4">
    <!-- Attendance Stats -->
    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #198754;">
            <div class="stat-label">Total Present</div>
      <div class="stat-value">@(ViewBag.PresentCount ?? 0)</div>
         <div class="stat-change positive">
       <i class="bi bi-check-circle"></i>
       <span>Present days</span>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #dc3545;">
   <div class="stat-label">Total Absent</div>
            <div class="stat-value">@(ViewBag.AbsentCount ?? 0)</div>
      <div class="stat-change negative">
  <i class="bi bi-x-circle"></i>
       <span>Absent days</span>
 </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #ffc107;">
 <div class="stat-label">Total Late</div>
  <div class="stat-value">@(ViewBag.LateCount ?? 0)</div>
            <div class="stat-change">
            <i class="bi bi-clock"></i>
 <span>Late arrivals</span>
 </div>
   </div>
    </div>

<div class="col-md-3">
  <div class="stat-card" style="border-left-color: #0d6efd;">
     <div class="stat-label">Attendance Rate</div>
            <div class="stat-value">@(ViewBag.AttendanceRate ?? 0)%</div>
       <div class="stat-change positive">
                <i class="bi bi-graph-up"></i>
        <span>Overall rate</span>
   </div>
        </div>
    </div>
</div>

<div class="row g-3">
    <!-- Child Summary -->
    <div class="col-lg-4">
        <div class="dashboard-card">
            <div class="card-header-custom">
       <h3 class="card-title">
            <i class="bi bi-person-badge-fill"></i>
           Child Summary
            </h3>
            </div>
  <div class="text-center mb-3">
 <div class="user-avatar mx-auto" style="width: 80px; height: 80px; font-size: 2rem; background: #ffc107;">
    <i class="bi bi-person-fill"></i>
      </div>
      <h5 class="mt-3 mb-1">@(ViewBag.StudentName ?? "No student found")</h5>
         <p class="text-muted mb-2">Student ID: @(ViewBag.StudentId ?? "N/A")</p>
   </div>
       <div class="list-group list-group-flush">
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
     <span class="text-muted"><i class="bi bi-book-fill me-2 text-primary"></i>Class</span>
    <strong>@(ViewBag.ClassName ?? "Not enrolled")</strong>
    </div>
          <div class="list-group-item d-flex justify-content-between align-items-center px-0">
     <span class="text-muted"><i class="bi bi-calendar3 me-2 text-success"></i>Total Classes</span>
     <strong>@(ViewBag.TotalClasses ?? 0)</strong>
   </div>
  <div class="list-group-item d-flex justify-content-between align-items-center px-0">
        <span class="text-muted"><i class="bi bi-check-circle-fill me-2 text-success"></i>Present</span>
       <strong>@(ViewBag.PresentCount ?? 0)</strong>
     </div>
       <div class="list-group-item d-flex justify-content-between align-items-center px-0">
       <span class="text-muted"><i class="bi bi-x-circle-fill me-2 text-danger"></i>Absent</span>
        <strong>@(ViewBag.AbsentCount ?? 0)</strong>
    </div>
            </div>
          <a asp-controller="Parent" asp-action="StudentProfile" class="btn btn-outline-primary w-100 mt-3">
       <i class="bi bi-eye-fill me-2"></i>View Full Profile
    </a>
        </div>
    </div>

    <!-- Attendance Overview Chart -->
    <div class="col-lg-8">
        <div class="dashboard-card">
        <div class="card-header-custom">
     <h3 class="card-title">
      <i class="bi bi-bar-chart-fill"></i>
      Attendance Overview
        </h3>
         <select class="form-select form-select-sm" style="width: auto;">
       <option selected>Last 30 Days</option>
     <option>Last 3 Months</option>
             <option>Last 6 Months</option>
    </select>
      </div>
<!-- Chart Placeholder -->
    <div class="text-center py-5" style="background: #f8f9fa; border-radius: 8px;">
       <i class="bi bi-graph-up" style="font-size: 4rem; color: #ffc107;"></i>
     <p class="text-muted mt-3 mb-0">Attendance visualization</p>
  <small class="text-muted">Based on @(ViewBag.TotalAttendance ?? 0) total records</small>
            </div>
            <div class="row mt-4 text-center">
   <div class="col-4">
<div class="p-3" style="background: rgba(25, 135, 84, 0.1); border-radius: 8px;">
<h4 class="mb-0" style="color: #198754;">
     @{
    var presentRate = ViewBag.TotalAttendance > 0 
      ? Math.Round((decimal)(ViewBag.PresentCount ?? 0) / ViewBag.TotalAttendance * 100, 1) 
      : 0;
           }
   @presentRate%
         </h4>
  <small class="text-muted">Present</small>
    </div>
  </div>
       <div class="col-4">
          <div class="p-3" style="background: rgba(220, 53, 69, 0.1); border-radius: 8px;">
               <h4 class="mb-0" style="color: #dc3545;">
             @{
     var absentRate = ViewBag.TotalAttendance > 0 
  ? Math.Round((decimal)(ViewBag.AbsentCount ?? 0) / ViewBag.TotalAttendance * 100, 1) 
              : 0;
       }
         @absentRate%
              </h4>
     <small class="text-muted">Absent</small>
         </div>
                </div>
      <div class="col-4">
        <div class="p-3" style="background: rgba(255, 193, 7, 0.1); border-radius: 8px;">
             <h4 class="mb-0" style="color: #ffc107;">
                 @{
       var lateRate = ViewBag.TotalAttendance > 0 
                ? Math.Round((decimal)(ViewBag.LateCount ?? 0) / ViewBag.TotalAttendance * 100, 1) 
 : 0;
      }
    @lateRate%
    </h4>
       <small class="text-muted">Late</small>
       </div>
    </div>
 </div>
        </div>
    </div>
</div>

<!-- Recent Attendance -->
<div class="row g-3 mt-3">
    <div class="col-12">
        <div class="dashboard-card">
        <div class="card-header-custom">
                <h3 class="card-title">
        <i class="bi bi-clock-history"></i>
           Recent Attendance
                </h3>
      <a asp-controller="Parent" asp-action="AttendanceHistory" class="btn btn-sm btn-outline-primary">
        View All <i class="bi bi-arrow-right"></i>
    </a>
            </div>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
      <thead>
            <tr>
    <th>Date</th>
         <th>Class</th>
       <th>Time In</th>
      <th>Status</th>
   <th>Remarks</th>
            </tr>
                    </thead>
        <tbody>
          @if (ViewBag.RecentAttendance != null && ((List<WebMobileAssignment.Models.Attendance>)ViewBag.RecentAttendance).Any())
        {
           @foreach (var attendance in (List<WebMobileAssignment.Models.Attendance>)ViewBag.RecentAttendance)
    {
    <tr>
       <td><i class="bi bi-calendar3 me-2 text-muted"></i>@attendance.Date.ToString("yyyy-MM-dd")</td>
           <td>@attendance.Class?.ClassName</td>
       <td>@attendance.TakenOn.ToString("h:mm tt")</td>
      <td>
   @{
          var badgeClass = attendance.Status switch
        {
    "Present" => "bg-success",
      "Absent" => "bg-danger",
  "Late" => "bg-warning",
             _ => "bg-secondary"
       };
 }
      <span class="badge @badgeClass">@attendance.Status</span>
   </td>
             <td>
   @if (attendance.Status == "Present")
                  {
     <text>On time</text>
 }
           else if (attendance.Status == "Late")
  {
      <text>Arrived late</text>
  }
  else
   {
   <text>-</text>
            }
  </td>
    </tr>
           }
            }
              else
  {
   <tr>
 <td colspan="5" class="text-center text-muted py-4">
      <i class="bi bi-inbox" style="font-size: 2rem;"></i>
        <p class="mb-0 mt-2">No attendance records found</p>
 </td>
            </tr>
            }
       </tbody>
  </table>
     </div>
        </div>
    </div>
</div>
